<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>personcenter</title>
    <script src="js/mui.min.js"></script>
     <script src="js/openwin.js"></script>
      <script src="js/weshare.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
     <link rel="stylesheet" href="css/weshare.css" />
      
    
    <style type="text/css">
    			 .mui-bar-tab .mui-tab-item.mui-active{
     	 	color: #929292;
     	 }
     	 body{
     	 	background: white;
     	 }
     #wrapper {
    		position: relative;
    		z-index: 1;
    		height: 35px;
    		width: 100%;
    		/*border: 1px solid black;*/
    		overflow: hidden;
    		font-weight: bolder;
    }
    #scroll{
    	position: absolute;
	z-index: 1;
	-webkit-tap-highlight-color: rgba(0,0,0,0);
	width: 200%;
	-webkit-touch-callout: none;
	-webkit-user-select: none;
	-webkit-text-size-adjust: none;
	overflow-x: scroll;
    }
    #scroll ul{
    		list-style: none;
    		padding: 0;
    		margin: 0;
    		display: -webkit-box;
    		
    }
    #scroll li{
    border: 1px solid #E4E4E4;
    	padding: 0;
    	margin: 0;
    width: 17%;
    	line-height: 35px;
    	overflow: hidden;
    	text-align: center;
    }
    .singleorder{
    	border-top: 2px solid #E4E4E4;
    border-bottom: 3px solid #E4E4E4;
    	float: left;
    }
    .singleorder div{
    	float: left;
    	
    }
    .proimg img{
    	width: 90%;
    	margin: 5px;
    	padding: auto;
    	
    }
    .orderinfo{
    	  	border-left: 1px solid #e4e4e4;
    }
    .numandtime{
    	border-bottom:1px solid #E4E4E4;
    	font-size:12px;
    	color: #A1A1A1;
    	font-weight: bolder;
    	padding: 3px;
    }
    .nameandprice{
    	border-bottom: 1px solid #e4e4e4;
    	padding: 10px;
    	font-weight: bolder;
    }
    .orderprice{
    	font-size: 13px;
    color: white;
    font-weight: bolder;
    background: #66cccc;
    width: 60px;
    padding: 3px;
    border-radius: 3px;
    }
    .towhotel{
    	font-size: 12px;
    	padding: 3px;
    	font-weight: bolder;
    	color: #A1A1A1;
    }
    .personneedaction{
   			width:50%;
    			text-align: center;
    			font-size: 13px;
    			font-weight: bolder;
    			color: black;
    			border-top: 1px solid #E4E4E4;
    			border-bottom: 3px solid #E4E4E4;
    			padding-top: 5px;
    			padding-bottom: 5px;
    			border-left:2px solid #E4E4E4 ;
   		}
   		.personneedaction .mui-icon{
   			font-size: 20px;
   			font-weight: bolder;
   		}
     </style>
     
</head>
<body>
	 <header class="mui-bar mui-bar-nav">
		<div class='header index-header'>
			<div class='logo' id='logo'></div>
			<h1 class='title' id='title'></h1>
			<a id="menu" href="#topPopover" class="mui-action-menu mui-icon mui-icon-bars mui-pull-right"></a>
		</div>
	</header>	
	<div id="topPopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" id='exchangeMall'>乐享集市
						</li>
						<li class="mui-table-view-cell" id='logout'>注销
						</li>
						
					</ul>
				</div>
			</div>
		</div>
	 
	 <div class="mui-content">
		 	<div class="userselfinfo" id='userinfo'>
		 		<div id ='setuserinfo' class='setuserselfinfo'>
				 		 <div class='userselfhead'><img id='userpic' src='images/default_head.jpg'/></div>
				 		 <div class='nicknameself' id='nicknameself'>weshare</div>
				 		 <span id='userrank' class="userselfnote">隐翼天使</span>
				 		 <div class='userselfpoints'>我的享豆:<span id='reward'>1234</span></div>
				 		 <div class='userselfnote' id='userselfnote'>被人需要是一种幸福</div>
			 		 </div>
		 	</div>
		 	<div  id='wrapper'>
		 		<div id='scroll'>
		 			<ul>
		 				<li id="myneed">我的需求</li>
		 				<li id='myhelped'>我帮过的</li>
		 				<li id='mefromothers'>别人眼中的我</li>
		 				<li id='exchangeorder'>兑换记录</li>
		 				<li>0</li>
		 				<li>0</li>
		 				<li>0</li>
		 				
		 			</ul>
		 		</div>
		   </div>	
		 	<div id="contentwarp">
		 		<!--<div class='singleorder mui-col-xs-12'>
		 			<div class="proimg mui-col-xs-3">
		 				<img src="images/default_head.jpg" alt="" />
		 			</div>
		 			<div class='orderinfo mui-col-xs-9'>
		 				<div class='numandtime mui-col-xs-12'>
		 						<div class='ordernum mui-col-xs-9'>订单号:1232323232132</div>
		 						<div class='ordertime mui-col-xs-3'>6天前</div>
		 				</div>
		 				<div class='nameandprice mui-col-xs-12'>
		 						<div class='ordername mui-col-xs-9'>cococdjkfjdf的房价肯定</div>
		 						<div class='orderprice mui-col-xs-3'>100享豆</div>
		 				</div>
		 				<div class='towhotel mui-col-xs-12'>
		 						收件人：18501773419
		 				</div>
		 			</div>
		 		</div>-->
               <div class="moreneed" id='moreneed'></div>
            </div>
	 </div>
	   <nav class="mui-bar mui-bar-tab">
			<a id="indextab" class="mui-tab-item" href="index.html">
				<span class="mui-icon mui-icon-home-filled"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a  id='needpublishtab' class="mui-tab-item" href="needpublish.html">
				<span class="mui-icon mui-icon-plus-filled"></span>
				<span class="mui-tab-label">发布</span>
			</a>
			<a  id='messagetab'class="mui-tab-item" href="message.html" >
				<span class="mui-icon mui-icon-email-filled"><span class="mui-badge" id='remindnum' style="display: none;"></span></span>
				<span class="mui-tab-label">消息</span>
			</a>
			<a  id='personcentertab'class="mui-tab-item" href="personcenter.html" style="color:#3f88b0;">
				<span class="mui-icon mui-icon-contact-filled"></span>
				<span class="mui-tab-label">我的</span>
			</a>
	  </nav>
	  <script type="text/javascript" charset="utf-8">
      	mui.init();
      	mui.plusReady(function(){
      		
      		 quitapp();
      		 username=plus.storage.getItem('username');
      		 getremindernum(username);
      		var reward=plus.storage.getItem('rewardpoints');
      		page=1;
      		var myneed= document.getElementById('myneed');
      		var myhelped=document.getElementById('myhelped');
      		var mefromothers= document.getElementById('mefromothers');
      		var exchangeorder=document.getElementById("exchangeorder");
      			server=plus.storage.getItem('server');
			document.getElementById("userpic").setAttribute('src',server+'uploads/'+plus.storage.getItem('userpic'));
			document.getElementById("nicknameself").innerText=plus.storage.getItem('nickname');
			document.getElementById("reward").innerText=plus.storage.getItem('rewardpoints');
			document.getElementById("userselfnote").innerText=plus.storage.getItem('usernote');
			document.getElementById("userrank").innerText=plus.storage.getItem('rank');
      		var pageweb=plus.webview.currentWebview();
      		var type=pageweb.type;
      		if(type=='need'){
      			getmyneed(username,page);
      		}else if(type=='fromothers'){
      			getfromothers(username);
      		}else if(type=='exchangeorder'){
      			getexchangeorder(username);
      		}else{
      			getmyneed(username,page);
      		}
 
      	 	plus.nativeUI.closeWaiting();
      	 	//切换至myneed
      	 myneed.addEventListener('tap',function(){
      	  	
      	  	page=1;
      	  	moreneed="<div id='moreneed' class='moreneed'></div>";
      		document.getElementById('contentwarp').innerHTML=moreneed;
      	  	getmyneed(username,page);
      	  });
      	  //切换至myhelped
      	  myhelped.addEventListener('tap',function(){
      	  	
      	  	getmyhelped(username);
      	  });
      	  //切换至他人评价
      	 mefromothers.addEventListener('tap',function(){
      	 	
      	  	getfromothers(username);
      	  });
      	  //切换至兑换订单
      	  exchangeorder.addEventListener('tap',function(){
      	 	
      	  	getexchangeorder(username);
      	  });
      	  //打开个人信息更新

      	   mui('#userinfo').on('tap','#setuserinfo',function(){
      	  	mui.openWindow({
      	  		url:'personset.html',
      	  		id:'personset',
      	  		createNew:true,
      	  		show:{
			     duration:300
		       }
      	  	})
      	  })
      	 //标记完成处理
      	 mui('#contentwarp').on('tap','.perneedaction',function(){
      	 	var needaction=this.getAttribute('data-action');
			var needid=this.getAttribute('data-id');
			var user=this.getAttribute('data-user');
			if(needaction==='已完成'){
				return false;
			}
      	 		mui.openWindow({
      	 			url:'markfinish.html',
      	 			id:'markfinish',
      	 			createNew:true,
					show:{
						aniShow: 'none',
						duration:300
					},
					extras:{
						needid:needid,
						user:user
					}
      	 		});
      	 	})
     //打开查看页面
       mui('#contentwarp').on('tap','.personneedaction',function(){
      	var needid=this.getAttribute('data-id');
      	var towho=this.getAttribute('data-user');
     		mui.openWindow({
     			url:'checkneedaction.html',
     			id:'checkneedaction',
     			createNew:true,
     			extras:{
     				needid:needid,
     				towho:towho
     			},
     			show:{
     				aniShow: 'slide-in-left',
     				duration:300
     			}
     		});
     	})
      	 	
      	});
 
      	//获取个人需求列表
      	function getmyneed(username,page){
      		myneed.style.background='#3f88b0';
      	 	myneed.style.color='white';
      	 	myhelped.style.background='white';
      	 	myhelped.style.color='black';
      	 	mefromothers.style.background='white';
      	 	mefromothers.style.color='black';
      	 	exchangeorder.style.background='white';
      	 	exchangeorder.style.color='black';
      		  var contentcontainer=document.getElementById("contentwarp");
      		var username=plus.storage.getItem('username');
				     	 mui.ajax(server+'getneedlist.php',{
			      			data:{
			      				action:'somebodyneed',
			      				page:page,
			      				username:username
			      			},
			      			type:'post',
			      			success:function(data){ 
			      				var jsondata=eval("["+data+"]");
			      				var needlist=jsondata[0];
//			      				
			      				if(needlist==''){
			      					

			      					html="<div class=\'commentblack\'>亲,您还没有发布需求呢</div>";
      	                             contentcontainer.innerHTML=html;
        	                           
			      				}else{
			      					var maxrows=needlist[0].maxRows;
			      				    var pagesize=needlist[0].pageSize;
			      					maxpages=needlist[0].maxPages;
			      					page++;
			      				if(maxrows<=pagesize){
			      					document.getElementById('moreneed').innerHTML='';
			      				}
			      				 else if(page>maxpages){
			      			     	add="<button  class='moreneedbtn'>"+"这就是全部了"+"</button>";
			      			     	document.getElementById('moreneed').innerHTML=add;
			      			    }else{
			      			    	add="<button  class='moreneedbtn' onclick='getmyneed("+username+","+page+");\'>"+"点击加载更多"+"</button>";
				      			document.getElementById('moreneed').innerHTML=add;
			      			    }
				      			
			      			   
			      				for(var i=0;i<=needlist.length;i++){
			      					var publishtime=timeFormat(needlist[i].publishtime);
			      					var needwarper=document.getElementById('moreneed');
			      					 html="<div class='needcontainer'>"+
								  	   	    "<div class='userhead'><img src='"+server+"uploads/"+needlist[i].head+"'/><div class='needid'>"+needlist[i].id+"</div></div>"+
								  	   	    "<div class='needlistlabel'>#"+needlist[0].label+"#</div>"+
								  	   	  	"<div class='perneedaction' data-id='"+needlist[i].id+"'data-user='"+needlist[i].user+"' data-action='"+needlist[i].actiontext+"'>"+needlist[i].actiontext+"</div>"+
								  	   	    
								  	   	    "<div class='needcontent'>"+needlist[i].remark+"</div>"+
								  	   	    	"<div class='needpay'>"+needlist[i].needpay+"享豆</div>"+
								  	   	   
								  	   	    "<div class='needlocation'>"+needlist[i].needlocation+"</div>"+
								  	   	    "<div class='needlisttime'>"+publishtime+"</div>"+
								  	   	   
								  	   		
								  	   		"<div class='personneedaction' data-id='"+needlist[i].id+"'data-user='"+needlist[i].user+"' ><span class='mui-icon mui-icon-navigate'></span>&nbsp;&nbsp;私信("+needlist[i].msgNum+")</div>"+
								  	   		"<div class='personneedaction' data-id='"+needlist[i].id+"'data-user='"+needlist[i].user+"'><span class='mui-icon mui-icon-email'></span>&nbsp;&nbsp;评论("+needlist[i].cmtNum+")</div>"+
								  	   "</div> ";
								  	 needwarper.insertAdjacentHTML('beforeBegin',html); 
								
			      				}
			      				}
			      				
			      							      				
			      			}
						 })
				     }     	       	 
      //获取myhelped列表
      function   getmyhelped(username){
      	    myhelped.style.background='#3f88b0';
      	 	myhelped.style.color='white';
      	 	myneed.style.background='white';
      	 	myneed.style.color='black';
      	 	mefromothers.style.background='white';
      	 	mefromothers.style.color='black';
      	 	exchangeorder.style.background='white';
      	 	exchangeorder.style.color='black';
      	  var username=plus.storage.getItem('username');
      	   var contentcontainer=document.getElementById("contentwarp");
      	   contentcontainer.innerHTML='';
      		 mui.ajax(server+'getneedlist.php',{
			      			data:{
			      				action:'myhelpedneed',
			      				username:username
			      			},
			      			type:'post',
			      			success:function(data){ 	
			      				
			      				var needwarper=document.getElementById('contentwarp');
			      				var jsondata=eval("["+data+"]");
			      				var needlist=jsondata[0];
			      				if(needlist==''){
			      					 html="<div class=\'commentblack\'>亲,您还没有帮过人呢</div>";
      	                             contentcontainer.innerHTML=html;	
			      				}
			      				for(var i=0;i<=needlist.length;i++){
			      					var publishtime=timeFormat(needlist[i].publishtime);
			      					 html="<div class='needcontainer'>"+
								  	   	    "<div class='userhead'><img src='"+server+"uploads/"+needlist[i].head+"'/><div class='needid'>"+needlist[i].id+"</div></div>"+
								  	   	    "<div class='needlistlabel'>#"+needlist[i].label+"#</div>"+
								  	   	    "<div class='needstatus'>"+needlist[i].status+"</div>"+
								  	   	    "<div class='needcontent'>"+needlist[i].remark+"</div>"+
								  	   	    "<div class='needpay'>"+needlist[i].needpay+"享豆</div>"+
								  	   	   
								  	   	    "<div class='needlocation helped'>"+needlist[i].needlocation+"</div>"+
								  	   	    "<div class='needlisttime helped'>"+publishtime+"</div>"+
								  	   "</div> ";
								  	 needwarper.insertAdjacentHTML('afterBegin',html); 
								
			      				}
			      				
			      			}
						 })
                        }   
       //获取mefromothers列表
      function   getfromothers(username){
      	    mefromothers.style.background='#3f88b0';
      	 	mefromothers.style.color='white';
      	 	myhelped.style.background='white';
      	 	myhelped.style.color='black';
      	 	myneed.style.background='white';
      	 	myneed.style.color='black';
      	 	exchangeorder.style.background='white';
      	 	exchangeorder.style.color='black';
      	  var username=plus.storage.getItem('username');
      	   var contentcontainer=document.getElementById("contentwarp");
      	   contentcontainer.innerHTML='';
      	  
      	   mui.ajax(server+'getthankorder.php',{
      	   	data:{
      	   		username:username
      	   	},
      	   	type:'post',
      	   	success:function(data){
      	   		
      	   	var contentcontainer=document.getElementById('contentwarp');
      	   	 var jsondata=eval("["+data+"]");
      	   	 var thankorderlist=jsondata[0];
      	   	 if(thankorderlist==''){
      	   	 	 html="<div class=\'commentblack\'>还没有来自别人的评价哎</div>";
      	   	 	  contentcontainer.innerHTML=html;	
      	   	 }
      	   	 for(var i=0;i<thankorderlist.length;i++){
      	   	 	var thanktime=timeFormat(thankorderlist[i].sendtime);
      	   	 	html="<div class='thankorder mui-col-xs-12'>"+
      	   	 		   "<div class='bywhohead mui-col-xs-2'><img src='"+server+"uploads/"+thankorderlist[i].bywhohead+"' alt='head' /></div>"+
      	   	 		   "<div class='mui-col-xs-10 thankordertop'>"+
               		"<div class='thankpay'>+"+thankorderlist[i].needpay+"享豆</div>"+
               		
               		"<div class='thanktime'>"+thanktime+"</div>"+
                 	"</div>"+
                 	"<div class='judgecontent mui-col-xs-10'>"+thankorderlist[i].judge+"</div>"+
                 	"</div>";
                 contentcontainer.insertAdjacentHTML('afterBegin',html);	
      	   	 }
      	   	
      	   	}
      	   })
      } 
     //获取兑换订单
     function getexchangeorder(){
     	    exchangeorder.style.background='#3f88b0';
      	 	exchangeorder.style.color='white';
      	 	myhelped.style.background='white';
      	 	myhelped.style.color='black';
      	 	mefromothers.style.background='white';
      	 	mefromothers.style.color='black';
      	 	myneed.style.background='white';
      	 	myneed.style.color='black';
     	var contentcontainer=document.getElementById('contentwarp');
     	 contentcontainer.innerHTML='';
     	mui.ajax(server+'getexchangeorder.php',{
     		data:{
     			action:'someones',
     			username:username
     		},
     		type:'post',
     		success:function(data){
//   			alert(data);
     			
			 var jsondata=eval("["+data+"]");
			 var exchangeorderlist=jsondata[0];
			 if(exchangeorderlist==''){
			 	 html="<div class=\'commentblack\'>还没有兑换订单</div>";
      	   	 	  contentcontainer.innerHTML=html;
			 }
			 for(var i=0;i<=exchangeorderlist.length;i++){
			 		
			 	sendtime=timeFormat(exchangeorderlist[i].addtime);
			 	 html2="<div class='singleorder mui-col-xs-12'>"+
		 			     "<div class='proimg mui-col-xs-3'>"+
		 				   "<img src='"+server+"uploads/"+exchangeorderlist[i].propic+"'/>"+
		 			     " </div>"+
		 			  " <div class='orderinfo mui-col-xs-9'>"+
		 				    "<div class='numandtime mui-col-xs-12'>"+
		 						"<div class='ordernum mui-col-xs-9'>订单号:"+exchangeorderlist[i].onum+"</div>"+
		 						"<div class='ordertime mui-col-xs-3'>"+sendtime+"</div>"+
		 				     "</div>"+
		 				"<div class='nameandprice mui-col-xs-12'>"+
		 						"<div class='ordername mui-col-xs-8'>"+exchangeorderlist[i].proname+"</div>"+
		 						"<div class='orderprice mui-col-xs-3'>"+exchangeorderlist[i].proprice+"享豆</div>"+
		 				"</div>"+
		 				 " <div class='towhotel mui-col-xs-12'>收件人:"+exchangeorderlist[i].towhotel+"</div>"+
		 			"</div>"+
		 		"</div>";
		 		 contentcontainer.insertAdjacentHTML('afterBegin',html2);	
			 }
     		}
     	})
     }
     
      
    </script>
</body>
</html>